<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inducci√≥n Planeaci√≥n Estrat√©gica - INFIBAGU√â</title>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #1e40af;
            --primary-light: #3b82f6;
            --secondary: #f59e0b;
            --accent: #10b981;
            --text: #1f2937;
            --bg: #f0f9ff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
        }

        .carousel-container {
            width: 100%;
            height: 100%;
            position: relative;
            background: white;
            overflow: hidden;
        }

        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease-in-out;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
        }

        .slide.active {
            opacity: 1;
            visibility: visible;
            z-index: 10;
        }

        .slide-content {
            max-width: 1100px;
            width: 100%;
            text-align: center;
        }

        h1,
        h2 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        p {
            font-size: 1.1rem;
            color: #6b7280;
            margin-bottom: 25px;
        }

        .progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 5px;
            background: var(--primary-light);
            width: 0%;
            transition: width 0.5s;
            z-index: 30;
        }

        /* --- HEADER CON BOT√ìN VOLVER A INICIO --- */
        .module-header {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            z-index: 100;
            min-width: 320px;
            max-width: 90%;
        }

        .module-header h2 {
            font-size: 1.1rem;
            color: var(--primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-back-home {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
            text-decoration: none;
        }

        .btn-back-home:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        }

        .btn-back-home:active {
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .module-header {
                padding: 10px 15px;
                min-width: auto;
                width: 95%;
            }

            .module-header h2 {
                font-size: 0.9rem;
            }

            .btn-back-home {
                padding: 6px 12px;
                font-size: 0.75rem;
            }

            .btn-back-home span {
                display: none;
            }
        }

        .nav-controls {
            position: absolute;
            bottom: 25px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 40px;
            z-index: 20;
            pointer-events: none;
        }

        .nav-btn {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 12px 28px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            pointer-events: auto;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* --- SLIDE 1: HERO --- */
        #slide-1 {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
        }

        .hero-badge {
            display: inline-block;
            background: var(--secondary);
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        /* --- SLIDE 2: DIRECCIONES HUB --- */
        .direcciones-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-top: 30px;
        }

        .dir-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            text-align: left;
        }

        .dir-card:hover {
            transform: translateY(-8px);
            border-color: var(--primary-light);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.15);
        }

        .dir-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .dir-operativa .dir-icon {
            background: #dbeafe;
        }

        .dir-proyectos .dir-icon {
            background: #fef3c7;
        }

        .dir-admin .dir-icon {
            background: #d1fae5;
        }

        .dir-card h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .dir-card ul {
            list-style: none;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .dir-card li {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dir-card li::before {
            content: '‚úì';
            color: var(--accent);
            font-weight: bold;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
        }

        /* --- SLIDE 3: JUEGO CONECTAR --- */
        .connect-game {
            display: grid;
            grid-template-columns: 1fr 100px 1fr;
            gap: 20px;
            align-items: center;
            max-width: 800px;
            margin: 20px auto;
        }

        .connect-col {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .connect-item {
            background: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .connect-item:hover {
            border-color: var(--primary-light);
            background: #f0f9ff;
        }

        .connect-item.selected {
            border-color: var(--primary);
            background: #dbeafe;
        }

        .connect-item.correct {
            border-color: var(--accent);
            background: #d1fae5;
        }

        .connect-item.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
        }

        .connect-lines {
            position: relative;
            height: 100%;
        }

        #game1-feedback {
            margin-top: 15px;
            font-weight: bold;
            min-height: 24px;
        }

        /* --- SLIDE 4: PUZZLE N√öMEROS --- */
        .number-puzzle {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            max-width: 700px;
            margin: 20px auto;
        }

        .puzzle-slot {
            background: #f3f4f6;
            padding: 20px;
            border-radius: 15px;
            border: 3px dashed #d1d5db;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 80px;
            transition: all 0.3s;
        }

        .puzzle-slot.drag-over {
            border-color: var(--primary-light);
            background: #dbeafe;
        }

        .puzzle-slot.correct {
            border-color: var(--accent);
            background: #d1fae5;
            border-style: solid;
        }

        .slot-label {
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slot-answer {
            width: 80px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            border: 2px solid #e5e7eb;
        }

        .number-bank {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .number-chip {
            width: 70px;
            height: 50px;
            background: var(--primary);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: grab;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(30, 64, 175, 0.3);
        }

        .number-chip:active {
            cursor: grabbing;
            transform: scale(1.1);
        }

        .number-chip.used {
            opacity: 0.3;
            pointer-events: none;
        }

        #game2-feedback {
            margin-top: 15px;
            font-weight: bold;
            min-height: 24px;
        }

        /* --- SLIDE 5: RESULTADO --- */
        .result-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 50px;
            border-radius: 30px;
            max-width: 500px;
            margin: 0 auto;
        }

        .result-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .direcciones-grid {
                grid-template-columns: 1fr;
            }

            .connect-game {
                grid-template-columns: 1fr;
            }

            .number-puzzle {
                grid-template-columns: 1fr;
            }

            h1,
            h2 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>

<body>

    <div class="progress-bar" id="progress-bar"></div>

    <!-- Header con bot√≥n volver a inicio -->
    <div class="module-header">
        <h2>üìä Planeaci√≥n Estrat√©gica</h2>
        <button class="btn-back-home" onclick="goBackHome()" title="Volver al inicio del m√≥dulo">
            <span>üè†</span>
            <span>Volver a Inicio</span>
        </button>
    </div>

    <div class="carousel-container">

        <!-- SLIDE 1: HERO -->
        <div class="slide active" id="slide-1">
            <div class="slide-content">
                <span class="hero-badge">Plan de Desarrollo 2024 - 2027</span>
                <h1>Programaci√≥n de Metas Vigencia 2026</h1>
                <p>"Ibagu√© para Todos" - Conoce las metas estrat√©gicas de INFIBAGU√â</p>
                <button class="nav-btn" style="margin: 0 auto;" onclick="nextSlide()">Comenzar üöÄ</button>
            </div>
        </div>

        <!-- SLIDE 2: DIRECCIONES HUB -->
        <div class="slide" id="slide-2">
            <div class="slide-content">
                <h2>Nuestras Direcciones y Metas üèõÔ∏è</h2>
                <p>Explora las metas clave de cada direcci√≥n para 2026.</p>

                <div class="direcciones-grid">
                    <div class="dir-card dir-operativa">
                        <div class="dir-icon">
                            <!-- Helmet Icon -->
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M12 2C8.13 2 5 5.13 5 9c0 1.74.5 3.37 1.41 4.84.95 1.54 2.2 2.86 3.59 4.16.8.75 1.21 1.83 1.21 2.92V21c0 .55.45 1 1 1h.5c.55 0 1-.45 1-1v-.08c0-1.09.41-2.17 1.21-2.92 1.39-1.3 2.64-2.62 3.59-4.16C18.5 12.37 19 10.74 19 9c0-3.87-3.13-7-7-7zm0 2c2.76 0 5 2.24 5 5 0 .22-.01.44-.04.65-.13-.08-.27-.14-.42-.18-1.55-.42-2.73-1.6-3.15-3.15-.04-.15-.1-.29-.18-.42.21-.03.43-.04.65-.04.05 0 .09 0 .14.01V5.13c-.48-.09-.98-.13-1.5-.13s-1.02.04-1.5.13v.78c.05 0 .09-.01.14-.01.22 0 .44.01.65.04-.08.13-.14.27-.18.42-.42 1.55-1.6 2.73-3.15 3.15-.15.04-.29.1-.42.18-.03-.21-.04-.43-.04-.65 0-2.76 2.24-5 5-5z" />
                            </svg>
                        </div>
                        <h3>Dir. Operativa y Comercial</h3>
                        <ul>
                            <li>
                                <div><span class="stat-number">2,174</span> Redes Mejoradas</div>
                            </li>
                            <li>
                                <div><span class="stat-number">93</span> Redes Ampliadas</div>
                            </li>
                            <li>
                                <div><span class="stat-number">126</span> Parques Mantenidos</div>
                            </li>
                        </ul>
                    </div>

                    <div class="dir-card dir-proyectos">
                        <div class="dir-icon">
                            <!-- Blueprint/Compass Icon -->
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M21.71 7.29l-3-3a1.003 1.003 0 00-1.42 0l-3 3c-.18.18-.29.43-.29.71 0 .55.45 1 1 1 .28 0 .53-.11.71-.29L16.59 8H11c-1.1 0-2 .9-2 2v9c0 1.1.9 2 2 2h9c1.1 0 2-.9 2-2v-9c0-.28-.11-.53-.29-.71-.37-.37-1.05-.37-1.42 0L19.41 10h-2.17l3.71-3.71c.39-.39.39-1.02.76-1.41zM5 19h6v2H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h12v6H9c-1.1 0-2 .9-2 2v8z" />
                            </svg>
                        </div>
                        <h3>Dir. Proyectos y Financiera</h3>
                        <ul>
                            <li>
                                <div><span class="stat-number">1</span> Pan√≥ptico Restaurado</div>
                            </li>
                            <li>
                                <div><span class="stat-number">8</span> Estaciones Bicicletas</div>
                            </li>
                        </ul>
                    </div>

                    <div class="dir-card dir-admin">
                        <div class="dir-icon">
                            <!-- House/Laptop Icon -->
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M20 18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z" />
                            </svg>
                        </div>
                        <h3>Dir. Administrativa</h3>
                        <ul>
                            <li>
                                <div><span class="stat-number">2</span> Mtto. Equipamientos</div>
                            </li>
                            <li>
                                <div>Gesti√≥n y PQRS</div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- SLIDE 3: JUEGO CONECTAR -->
        <div class="slide" id="slide-3">
            <div class="slide-content">
                <h2>Juego: Conecta la Meta üîó</h2>
                <p>Selecciona una meta y luego la direcci√≥n responsable.</p>

                <div class="connect-game">
                    <div class="connect-col" id="metas-col">
                        <div class="connect-item meta" data-answer="operativa" onclick="selectMeta(this)">üí° Alumbrado
                            P√∫blico</div>
                        <div class="connect-item meta" data-answer="proyectos" onclick="selectMeta(this)">üèõÔ∏è
                            Restauraci√≥n Pan√≥ptico</div>
                        <div class="connect-item meta" data-answer="operativa" onclick="selectMeta(this)">üå≥ Parques y
                            Zonas Verdes</div>
                        <div class="connect-item meta" data-answer="admin" onclick="selectMeta(this)">üè¢ Mantenimiento
                            Equipamientos</div>
                        <div class="connect-item meta" data-answer="proyectos" onclick="selectMeta(this)">üö≤ Rueda por
                            Ibagu√©</div>
                    </div>

                    <div class="connect-lines">‚û°Ô∏è</div>

                    <div class="connect-col" id="dirs-col">
                        <div class="connect-item dir" data-dir="operativa" onclick="selectDir(this)">üîß Dir. Operativa
                        </div>
                        <div class="connect-item dir" data-dir="proyectos" onclick="selectDir(this)">üìê Dir. Proyectos
                        </div>
                        <div class="connect-item dir" data-dir="admin" onclick="selectDir(this)">üè¢ Dir. Admin</div>
                    </div>
                </div>
                <div id="game1-feedback"></div>
                <p id="game1-score" style="font-size: 0.9rem; color: #6b7280;">Aciertos: 0 / 5</p>
            </div>
        </div>

        <!-- SLIDE 4: PUZZLE N√öMEROS -->
        <div class="slide" id="slide-4">
            <div class="slide-content">
                <h2>Juego: Puzzle de N√∫meros üß©</h2>
                <p>Arrastra el n√∫mero correcto a cada meta.</p>

                <div class="number-puzzle">
                    <div class="puzzle-slot" data-answer="2174" ondrop="dropNumber(event)" ondragover="allowDrop(event)"
                        ondragleave="leaveDrop(event)">
                        <span class="slot-label">üí° Redes Mejoradas</span>
                        <div class="slot-answer" id="slot-1"></div>
                    </div>
                    <div class="puzzle-slot" data-answer="126" ondrop="dropNumber(event)" ondragover="allowDrop(event)"
                        ondragleave="leaveDrop(event)">
                        <span class="slot-label">üå≥ Parques Mantenidos</span>
                        <div class="slot-answer" id="slot-2"></div>
                    </div>
                    <div class="puzzle-slot" data-answer="8" ondrop="dropNumber(event)" ondragover="allowDrop(event)"
                        ondragleave="leaveDrop(event)">
                        <span class="slot-label">üö≤ Estaciones Bicicletas</span>
                        <div class="slot-answer" id="slot-3"></div>
                    </div>
                    <div class="puzzle-slot" data-answer="1" ondrop="dropNumber(event)" ondragover="allowDrop(event)"
                        ondragleave="leaveDrop(event)">
                        <span class="slot-label">üèõÔ∏è Restauraci√≥n Pan√≥ptico</span>
                        <div class="slot-answer" id="slot-4"></div>
                    </div>
                </div>

                <div class="number-bank" id="number-bank">
                    <div class="number-chip" draggable="true" ondragstart="dragNumber(event)" data-value="126">126</div>
                    <div class="number-chip" draggable="true" ondragstart="dragNumber(event)" data-value="2174">2,174
                    </div>
                    <div class="number-chip" draggable="true" ondragstart="dragNumber(event)" data-value="1">1</div>
                    <div class="number-chip" draggable="true" ondragstart="dragNumber(event)" data-value="8">8</div>
                </div>
                <div id="game2-feedback"></div>
            </div>
        </div>

        <!-- SLIDE 5: RESULTADO -->
        <div class="slide" id="slide-5">
            <div class="slide-content">
                <div class="result-card">
                    <div class="result-icon">üèÜ</div>
                    <h2 style="background: none; -webkit-text-fill-color: white;">¬°M√≥dulo Completado!</h2>
                    <p style="color: rgba(255,255,255,0.9);">Has aprendido las metas estrat√©gicas de INFIBAGU√â para
                        2026.</p>
                    <button class="nav-btn"
                        style="background: white; color: var(--primary); border-color: white; margin: 0 auto;"
                        onclick="finishModule()">Finalizar Curso ‚úÖ</button>
                </div>
            </div>
        </div>

        <div class="nav-controls">
            <button class="nav-btn prev-btn" onclick="prevSlide()" style="opacity:0">‚¨Ö Anterior</button>
            <button class="nav-btn next-btn" onclick="nextSlide()">Siguiente ‚û°</button>
        </div>
    </div>

    <script src="../js/utils.js"></script>
    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;
        const progressBar = document.getElementById('progress-bar');
        const prevBtn = document.querySelector('.prev-btn');
        const nextBtn = document.querySelector('.next-btn');

        function updateSlide() {
            slides.forEach((slide, index) => {
                slide.classList.remove('active');
                if (index === currentSlide) slide.classList.add('active');
            });
            progressBar.style.width = `${((currentSlide + 1) / totalSlides) * 100}%`;
            prevBtn.style.opacity = currentSlide === 0 ? '0' : '1';
            prevBtn.style.pointerEvents = currentSlide === 0 ? 'none' : 'all';
            nextBtn.style.display = currentSlide === totalSlides - 1 ? 'none' : 'flex';
        }

        function nextSlide() { if (currentSlide < totalSlides - 1) { currentSlide++; updateSlide(); } }
        function prevSlide() { if (currentSlide > 0) { currentSlide--; updateSlide(); } }

        // --- GAME 1: CONNECT ---
        let selectedMeta = null;
        let game1Score = 0;

        function selectMeta(el) {
            document.querySelectorAll('.meta').forEach(m => m.classList.remove('selected'));
            el.classList.add('selected');
            selectedMeta = el;
        }

        function selectDir(el) {
            if (!selectedMeta) {
                document.getElementById('game1-feedback').innerHTML = '<span style="color:#f59e0b">Primero selecciona una meta</span>';
                return;
            }

            const answer = selectedMeta.dataset.answer;
            const dir = el.dataset.dir;

            if (answer === dir) {
                selectedMeta.classList.remove('selected');
                selectedMeta.classList.add('correct');
                selectedMeta.style.pointerEvents = 'none';
                game1Score++;
                document.getElementById('game1-feedback').innerHTML = '<span style="color:#10b981">¬°Correcto! ‚úÖ</span>';
            } else {
                document.getElementById('game1-feedback').innerHTML = '<span style="color:#ef4444">Incorrecto, intenta de nuevo ‚ùå</span>';
            }

            document.getElementById('game1-score').textContent = `Aciertos: ${game1Score} / 5`;
            selectedMeta = null;
            document.querySelectorAll('.meta').forEach(m => m.classList.remove('selected'));

            if (game1Score === 5) {
                document.getElementById('game1-feedback').innerHTML = '<span style="color:#10b981">¬°Juego Completado! üéâ</span>';
                setTimeout(() => nextSlide(), 1500);
            }
        }

        // --- GAME 2: NUMBER PUZZLE ---
        let game2Score = 0;

        function dragNumber(ev) {
            ev.dataTransfer.setData("text", ev.target.dataset.value);
            ev.dataTransfer.setData("chipId", ev.target.id || ev.target.dataset.value);
        }

        function allowDrop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.add('drag-over');
        }

        function leaveDrop(ev) {
            ev.currentTarget.classList.remove('drag-over');
        }

        function dropNumber(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('drag-over');

            const slot = ev.currentTarget;
            const slotAnswer = slot.querySelector('.slot-answer');

            if (slotAnswer.textContent) return; // Already filled

            const value = ev.dataTransfer.getData("text");
            const correctAnswer = slot.dataset.answer;

            slotAnswer.textContent = value === '2174' ? '2,174' : value;

            if (value === correctAnswer) {
                slot.classList.add('correct');
                game2Score++;
                document.getElementById('game2-feedback').innerHTML = '<span style="color:#10b981">¬°Correcto! ‚úÖ</span>';

                // Mark chip as used
                document.querySelectorAll('.number-chip').forEach(chip => {
                    if (chip.dataset.value === value) chip.classList.add('used');
                });

                if (game2Score === 4) {
                    document.getElementById('game2-feedback').innerHTML = '<span style="color:#10b981">¬°Puzzle Completado! üéâ</span>';
                    setTimeout(() => nextSlide(), 1500);
                }
            } else {
                document.getElementById('game2-feedback').innerHTML = '<span style="color:#ef4444">Ese n√∫mero no es correcto ‚ùå</span>';
                slotAnswer.textContent = ''; // Clear wrong answer
            }
        }

        // Funci√≥n para finalizar la inducci√≥n completa
        async function finishModule() {
            const finishBtn = document.querySelector('.result-card .nav-btn');
            if (finishBtn) {
                finishBtn.disabled = true;
                finishBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
            }

            try {
                if (window.SupabaseProgress) {
                    // Este es el √∫ltimo m√≥dulo - marca la inducci√≥n como completada
                    const result = await window.SupabaseProgress.finishModuleAndNavigate(
                        'planeacion_estrategica',
                        100,
                        100
                    );

                    console.log('üéâ Inducci√≥n completada! Resultado:', result);

                    // Notificar al padre si est√° en iframe
                    if (window.parent !== window) {
                        window.parent.postMessage({
                            type: 'MODULO_INDUCCION_COMPLETADO',
                            data: {
                                moduleId: 'planeacion',
                                moduleName: 'planeacion_estrategica',
                                aprobado: true,
                                induccionCompleta: true,
                                fecha: new Date().toISOString()
                            }
                        }, '*');

                        // Notificar que la inducci√≥n completa ha terminado
                        window.parent.postMessage({
                            type: 'INDUCCION_COMPLETA',
                            data: {
                                fecha: new Date().toISOString()
                            }
                        }, '*');
                    }

                    // Mostrar mensaje de felicitaci√≥n
                    alert('¬°Felicitaciones! Has completado exitosamente toda la inducci√≥n de INFIBAGU√â.');

                    // Redirigir al dashboard
                    setTimeout(() => {
                        window.location.href = '../funcionario/dashboard.html';
                    }, 500);
                } else {
                    console.warn('‚ö†Ô∏è SupabaseProgress no disponible');
                    alert('M√≥dulo Completado!');
                    window.location.href = '../funcionario/dashboard.html';
                }
            } catch (error) {
                console.error('Error al guardar progreso:', error);
                alert('Ocurri√≥ un error al guardar tu progreso.');
                if (finishBtn) {
                    finishBtn.disabled = false;
                    finishBtn.textContent = 'Finalizar Curso ‚úÖ';
                }
            }
        }

        updateSlide();

        // Funci√≥n para volver al inicio del m√≥dulo
        function goBackHome() {
            currentSlide = 0;
            updateSlide();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>

    <!-- Supabase Config -->
    <script src="../js/config.js"></script>
    <!-- Sistema de Progreso con Supabase -->
    <script src="../js/progress.js"></script>

    <!-- Inicializar Supabase y validar acceso al cargar -->
    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            if (typeof inicializarSupabase === 'function') {
                inicializarSupabase();
                console.log('‚úÖ Supabase inicializado para Planeaci√≥n Estrat√©gica');
            }

            if (window.SupabaseProgress) {
                try {
                    // 1. Validar acceso (Async)
                    const accessResult = await window.SupabaseProgress.canAccessModule('planeacion_estrategica');

                    if (!accessResult.allowed) {
                        console.warn('Acceso denegado:', accessResult.message);
                        alert(accessResult.message);
                        window.location.href = accessResult.redirectTo || '../funcionario/dashboard.html';
                        return;
                    }

                    // 2. Verificar progreso (Async)
                    const progress = await window.SupabaseProgress.getModuleProgress('planeacion_estrategica');

                    if (progress && progress.status === 'approved') {
                        // Preguntar si quiere repasar
                        console.log('M√≥dulo Planeaci√≥n completado. Modo repaso.');
                    }

                    // 3. Iniciar m√≥dulo (Async)
                    await window.SupabaseProgress.startModule('planeacion_estrategica');
                    console.log('üöÄ M√≥dulo Planeaci√≥n iniciado en Supabase');

                } catch (error) {
                    console.error('Error inicializando Planeaci√≥n con Supabase:', error);
                }
            }
        });
    </script>
    <!DOCTYPE html>
    <html lang="es">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Inducci√≥n Planeaci√≥n Estrat√©gica</title>

        <!-- Estilos b√°sicos -->
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 0;
                background: #f5f7fa;
            }

            .container {
                max-width: 900px;
                margin: auto;
                padding: 20px;
                background: white;
                min-height: 100vh;
            }

            h1 {
                text-align: center;
            }

            .btn {
                background: #2563eb;
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 16px;
                margin-top: 20px;
            }

            .btn:disabled {
                background: gray;
                cursor: not-allowed;
            }

            .hidden {
                display: none;
            }
        </style>
    </head>

    <!-- SUPABASE CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Cliente Supabase Centralizado -->
    <script src="../js/supabaseClient.js"></script>

</body>

</html>